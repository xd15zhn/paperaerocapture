%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Model
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{飞行器再入动力学方程}
本节推导不考虑火星自转时的飞行器再入制导的动力学方程，
假设飞行器只受空气动力和重力，无风干扰。

首先建立坐标系\cite{mdelong2006}。

1. 火星赤道惯性坐标系($OX_IY_IZ_I$)：
原点$O$位于火星球心，
$OX_I$轴指向火星赤道平面与黄道平面相交节线的升交点，
$OZ_I$轴垂直于赤道平面指向北极，
$OY_I$轴与$OX_I$和$OZ_I$轴组成右手正交坐标系。
该坐标系与地球赤道惯性坐标系定义相仿。

2. 火星赤道固连坐标系($OXYZ$)：
原点$O$位于火星球心，
$OX$轴在赤道平面内指向零经度线，
$OZ$轴垂直于赤道平面指向北极，
$OY$轴与$OX$和$OZ$轴组成右手正交坐标系。
该坐标系与火星固连，
并相对火星赤道惯性坐标系以火星自转角速度$\omega$转动。

3. 飞行器位置坐标系($Oxyz$)：
又称"天东北坐标系"，
原点$O$位于火星球心，
$Ox$轴指向飞行器质心$M$，
$Oy$轴在赤道平面与$Ox$轴垂直，
$Oz$轴与$Ox$和$Oy$轴组成右手正交坐标系。

4. 飞行器速度坐标系($Mx_vy_vz_v$)：
原点$M$位于飞行器质心，
$Mx_v$轴平行于$Ox$轴，
$Mz_v$轴指向飞行器速度方向，
$My_v$轴与$Mx_v$和$Mz_v$轴组成右手正交坐标系。

气动飞行期间轨道动力学建立在火星赤道固连坐标系$O-XYZ$下，
状态变量定义为：
\[[r\quad\theta\quad\phi\quad V\quad\gamma\quad\psi]\]
其中，
$r$为飞行器距球心的距离，
$\theta$为飞行器当前经度，向东为正，
$\phi$为飞行器当前纬度，向北为正，
$V$为火星赤道固连坐标系下的速度大小，
$\gamma$和$\psi$分别为航迹角和航向角。
航迹角定义为飞行器速度向量与当地水平面的夹角，
速度方向沿铅锤面向上为正；
航向角定义为当地东向与飞行器速度向量在当地水平面的投影的夹角，
速度方向向北偏为正。

飞行器在三维空间中的运动可以由
位置$\vec{r}(t)$和
速度$\vec{v}(t)$两个向量来表征。

用$\vec{i}$,$\vec{j}$,$\vec{k}$分别表示位置坐标系$Oxyz$的三轴单位向量在固连坐标系$OXYZ$下的坐标，
与前文中的$\vec{a}_x$,$\vec{a}_y$,$\vec{a}_z$表示类似，
则固连坐标系下的位置向量$\vec{r}$、速度向量$\vec{V}$、火星角速度向量$\vec{\omega}$分别表示成位置坐标系下的向量为
\begin{align}
    \vec{r} =& r\vec{i} \label{eqModelr}\\
    \vec{V} =& V\sin\gamma\vec{i} + V\cos\gamma\cos\psi\vec{j} + V\cos\gamma\sin\psi\vec{k} \label{eqModelV}\\
    \vec{\omega} =& \omega\sin\phi\vec{i} + \omega\cos\phi\vec{k} \notag
\end{align}
举例说明，
用$\vec{e}_x$,$\vec{e}_y$,$\vec{e}_z$分别表示固连坐标系$OXYZ$的三轴单位向量在固连坐标系下的坐标，
即$[\vec{e}_x\ \vec{e}_y\ \vec{e}_z]$为单位矩阵，
则速度向量式\eqref{eqModelV}可以表示为
\begin{equation*}
    \vec{V}
    =\left[\begin{matrix}
        \vec{e}_x & \vec{e}_y & \vec{e}_z
    \end{matrix}\right]
    \left[\begin{matrix}
        V_x \\ V_y \\ V_z
    \end{matrix}\right]
    =\left[\begin{matrix}
        \vec{i} & \vec{j} & \vec{k}
    \end{matrix}\right]
    \left[\begin{matrix}
        V\sin\gamma \\ V\cos\gamma\cos\psi \\ V\cos\gamma\sin\psi
    \end{matrix}\right]
\end{equation*}

坐标系$Oxyz$是坐标系$OXYZ$绕$OZ$轴正向转动$\theta$角，然后绕$Oy$轴负向转动$\phi$角得到的，
因此，坐标系$Oxyz$绕坐标系$OXYZ$的角速度大小$\Omega$为
\[\Omega = \dot{\theta} + \dot{\phi}\]
位置坐标系$Oxyz$下的角速度向量$\vec{\Omega}$为
\[\vec{\Omega} = \dot{\theta}\sin\phi\vec{i} - \dot{\phi}\vec{j} +\dot{\theta}\cos\phi\vec{k}\]
由此可以得出$\vec{i}$,$\vec{j}$,$\vec{k}$相对固连坐标系$OXYZ$的时间导数
\begin{align*}
    \frac{\text{\text{\text{\text{\text{d}}}}}\vec{i}}{\text{\text{\text{\text{\text{d}}}}}t} &=\vec{\omega} \times \vec{i}
    =  \left(\cos \phi \frac{\text{\text{\text{\text{\text{d}}}}}\theta}{\text{\text{\text{\text{\text{d}}}}}t}\right) \vec{j}
    + \left(\frac{\text{\text{\text{\text{\text{d}}}}}\phi}{\text{\text{\text{\text{\text{d}}}}}t}\right) \vec{k} \\
    \frac{\text{d}\vec{j}}{\text{d}t} &=\vec{\omega} \times \vec{j}
    = -\left(\cos \phi \frac{\text{d}\theta}{\text{d}t}\right) \vec{i}
    + \left(\sin \phi \frac{\text{d}\theta}{\text{d}t}\right) \vec{k} \\
    \frac{\text{d}\vec{k}}{\text{d}t} &=\vec{\omega} \times \vec{k}
    = -\left(\frac{\text{d}\phi}{\text{d}t}\right) \vec{i}
    - \left(\sin \phi \frac{\text{d}\theta}{\text{d}t}\right) \vec{j}
\end{align*}
式\eqref{eqModelr}求导得到速度
\[
    \vec{V}=\frac{\text{d}\vec{r}}{\text{d}t}
    =\left(\frac{\text{d}r}{\text{d}t}\right)\vec{i}
    +\left(r\cos\phi\frac{\text{d}\theta}{\text{d}t}\right)\vec{j}
    +\left(r\frac{\text{d}\phi}{\text{d}t}\right)\vec{k}
\]
与式\eqref{eqModelV}比较可得到
\begin{align*}
    \frac{\text{d}r}{\text{d}t} &=V\sin\gamma \\
    \frac{\text{d}\theta}{\text{d}t}&=\frac{V\cos\gamma\sin\psi}{r\cos\phi} \\
    \frac{\text{d}\phi}{\text{d}t}&=\frac{V\cos\gamma\cos\psi}{r}
\end{align*}
对$\vec{V}$求导可以得到
\begin{align*}
    \frac{d \vec{V}}{d t}=& {\left[\sin \gamma \frac{d V}{d t}+V \cos \gamma \frac{d \gamma}{d t}-\frac{V^{2}}{r} \cos ^{2} \gamma\right] \vec{i} } \\
    &+\left[\cos \gamma \sin \psi \frac{d V}{d t}-V \sin \gamma \sin \psi \frac{d \gamma}{d t}+V \cos \gamma \cos \psi \frac{d \psi}{d t}\right.\\
    &\left.+\frac{V^{2}}{r} \cos \gamma \sin \psi(\sin \gamma-\cos \gamma \cos \psi \tan \phi)\right] \vec{j} \\
    &+\left[\cos \gamma \cos \psi \frac{d V}{d t}-V \sin \gamma \cos \psi \frac{d \gamma}{d t}-V \cos \gamma \sin \psi \frac{d \psi}{d t}\right.\\
    &\left.+\frac{V^{2}}{r} \cos \gamma\left(\sin \gamma \cos \psi+\cos \gamma \sin ^{2} \psi \tan \phi\right)\right] \vec{k}
\end{align*}

气动力的升力和阻力表达式为
\begin{equation*}
    \left[\begin{matrix}
        L \\ D
    \end{matrix}\right]
    = \frac{1}{2}\rho V^2S_{\text{ref}}
    \left[\begin{matrix}
        C_L \\ C_D
    \end{matrix}\right]
\end{equation*}
其中，
$\rho$为火星大气密度，
$S_{\text{ref}}$为飞行器的气动参考面积，
$C_L$、$C_D$分别为升力系数和阻力系数，
为简化问题可设除了大气密度$\rho$以外其余均为常数。
升力、阻力和速度三个向量位于同一平面内，称为阻力平面。
阻力平面与铅垂面的夹角称为倾侧角$\sigma<90^{\circ}$。
阻力和速度方向相反，
升力在阻力平面内与速度向量垂直，方向向上。

火星大气密度$\rho$在简化大气指数模型中可以用
\[\rho=\rho_0e^{-h/h_s}\]
表示，其中参考密度$\rho_0=1.474\times10^7$kg/km$^2$，
比例高度$h_s=8.8057$km。
