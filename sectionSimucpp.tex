%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Real
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{实时仿真理论}
宇宙中各天体的自转或公转周期通常以天甚至以年计算，且轨道速度快，空间尺度大。为了能够在计算机上使用微分方程求解器\cite{olzhn2021}直观地实时展示仿真结果，需要对一些公式的单位进行换算。\par
万有引力公式中，
$$\frac{\text{d}^2\vec{r}}{\text{d}t^2}=-\frac{\mu}{r^3}\vec{r}$$
中，$r$的单位是km，$t$的单位是s。因为实际的尺度太大，一个天文单位达到了$10^8$数量级，为了便于仿真，需要将实际尺度中的时间和距离变换到一个合适的时空坐标系下。
首先列举一些名词解释。实际时间：指宇宙尺度上的实际时间；无单位求解器时间：指微分方程求解器中自变量的值，没有单位，简称求解器时间，对应的速度和距离也都没有单位；仿真器消耗时间：例如仿真器exe文件运行1秒对应实际时间的1000秒，此处的1秒就是仿真器消耗时间，简称仿真器时间。现设置求解器时间的1单位时间等于实际时间的$10^4$秒，1单位距离等于实际距离$10^6$km，即在仿真软件中，
$$t_1=10^{-4}t,\ r_1=10^{-6}r$$
其中$t$和$r$分别为以秒和千米为单位的实际时间和实际距离，而$t_1$和$r_1$分别表示求解器时间和求解器距离。举个例子，1个天文单位为$r=1.5*10^8$km，则仿真软件中的1个天文单位为$r_1=150$。
然后可以计算出实际时间/速度/距离和求解器时间/速度/距离之间的一些换算关系
$$\begin{aligned}
v_1 =& \frac{\text{d}r_1}{\text{d}t_1}
 = \frac{10^{-6}\text{d}r}{10^{-4}\text{d}t} = 10^{-2}v \\
a_1 =& \frac{\text{d}}{\text{d}t_1}\frac{\text{d}r_1}{\text{d}t_1}
 = 10^2\frac{\text{d}^2r}{\text{d}t^2} \\
\mu_1(\frac{(10^{-6}\text{km})^3}{\text{kg}\cdot(10^{-4}\text{s})^2})
 =& 10^{-10}\mu(\frac{\text{km}^3}{\text{kg}\cdot \text{s}^2}) \\
-\frac{\mu_1}{r_1^2} =& -10^2\frac{\mu}{r^2} = 10^2\frac{\text{d}^2r}{\text{d}t^2} = a_1
\end{aligned}$$
可以验证，实际中的微分方程
$$a=-\frac{\mu}{r^2}$$
变换到仿真软件中仍然为
$$a_1=-\frac{\mu_1}{r_1^2}$$
若仿真步长设置为0.01求解器时间，每帧仿真10步，则实际上步长为100秒，每帧代表1000秒，按60帧计算，则仿真时间1秒等于实际时间$6\times10^4$秒，地球速度按30km/s算则仿真时间1秒内地球走过$1.8\times10^6$km，换算回仿真中则走过1.8求解器距离。
换一种方法计算，地球的求解器速度是$v_1=10^{-2}\times30=0.3$，仿真软件每1秒仿真 ：60帧 $\times$ 10步/帧 $\times$ 0.01单位时间/步=6个时间单位，也可以得到仿真时间1秒内地球走过1.8求解器距离。

% ////////////////////////////////////////////////////////////////
\subsection{轨道六根数和位置速度向量}
轨道六根数指：半长轴(a)、偏心率(e)，轨道倾角(i)，升交点赤经($\Omega$)、近地点幅角($\omega$)、真近点角($\phi$)。根据文献\cite{mruiter2012}中的公式计算相关参数，已知进入轨道上某一点的速度$v_0$和该点与火星球心的距离$r_0$计算无穷远点速度
\[\begin{aligned}
    &\mathcal{E}=\frac{v_0^2}{2}-\frac{\mu}{r_0} = \frac{v_{inf}^2}{2} \\
    &v_{inf}=\sqrt{v_0^2-\frac{2\mu_m}{r}}
\end{aligned}\]
其中$\mu_m=42808$为火星的$\mu$值。计算进入火星的双曲线轨道半长轴参数$a$
\[\begin{aligned}
    &\mathcal{E}=-\frac{\mu}{2a} \\
    &a=-\frac{\mu_m}{2\mathcal{E}}=-\frac{\mu_m}{v_{inf}^2}
\end{aligned}\]
计算双曲线轨道偏心率$e$
\[\begin{aligned}
    &a=\frac{p}{1-e^2},p=\frac{h^2}{\mu} \\
    &e=\sqrt{1-\frac{h^2}{a\mu}}
\end{aligned}\]
其中$p$称为半通径，$h$为角动量大小。
计算真近点角$f$
\[\begin{aligned}
    &r=\frac{p}{1+e\cos f} \\
    &f=\arccos(\frac{1}{e}(\frac{h^2}{\mu r}-1))
\end{aligned}\]
由文献\cite{mruiter2012}中的公式(3.82)计算速度向量
\[
    \vec{v}=\sqrt{\frac{\mu}{a(1-e^2)}}
    \left[\begin{matrix}
        -\sin f \\ e+\cos f \\ 0
    \end{matrix}\right]
\]
根据平近点角计算真近点角\cite{msmart1977}
\begin{align*}
    f =& M+\left(2e-{\frac {1}{4}}e^{3}\right)\sin {M}
    + {\frac {5}{4}}e^{2}\sin {2M} \\
    &+ {\frac {13}{12}}e^{3}\sin {3M}+O(e^{4})
\end{align*}
